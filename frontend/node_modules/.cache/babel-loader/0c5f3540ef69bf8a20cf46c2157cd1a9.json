{"ast":null,"code":"import React,{useContext,useEffect,useReducer,useState,useRef}from\"react\";import{Link as RouterLink}from\"react-router-dom\";import ListItem from\"@material-ui/core/ListItem\";import ListItemIcon from\"@material-ui/core/ListItemIcon\";import ListItemText from\"@material-ui/core/ListItemText\";import ListSubheader from\"@material-ui/core/ListSubheader\";import Divider from\"@material-ui/core/Divider\";import{Badge}from\"@material-ui/core\";import DashboardOutlinedIcon from\"@material-ui/icons/DashboardOutlined\";import WhatsAppIcon from\"@material-ui/icons/WhatsApp\";import SyncAltIcon from\"@material-ui/icons/SyncAlt\";import SettingsOutlinedIcon from\"@material-ui/icons/SettingsOutlined\";import PeopleAltOutlinedIcon from\"@material-ui/icons/PeopleAltOutlined\";import ContactPhoneOutlinedIcon from\"@material-ui/icons/ContactPhoneOutlined\";import AccountTreeOutlinedIcon from\"@material-ui/icons/AccountTreeOutlined\";import FlashOnIcon from\"@material-ui/icons/FlashOn\";import HelpOutlineIcon from\"@material-ui/icons/HelpOutline\";import CodeRoundedIcon from\"@material-ui/icons/CodeRounded\";import LocalOfferIcon from\"@material-ui/icons/LocalOffer\";import PeopleIcon from\"@material-ui/icons/People\";import ListIcon from\"@material-ui/icons/ListAlt\";import AnnouncementIcon from\"@material-ui/icons/Announcement\";import ForumIcon from\"@material-ui/icons/Forum\";import LocalAtmIcon from'@material-ui/icons/LocalAtm';import RotateRight from\"@material-ui/icons/RotateRight\";import{i18n}from\"../translate/i18n\";import{WhatsAppsContext}from\"../context/WhatsApp/WhatsAppsContext\";import{AuthContext}from\"../context/Auth/AuthContext\";import LoyaltyRoundedIcon from'@material-ui/icons/LoyaltyRounded';import{Can}from\"../components/Can\";import{SocketContext}from\"../context/Socket/SocketContext\";import{isArray}from\"lodash\";import api from\"../services/api\";import BorderColorIcon from'@material-ui/icons/BorderColor';import toastError from\"../errors/toastError\";import{makeStyles}from\"@material-ui/core/styles\";import{AllInclusive,AttachFile,DeviceHubOutlined,Schedule}from'@material-ui/icons';import usePlans from\"../hooks/usePlans\";import Typography from\"@material-ui/core/Typography\";import{FaBell}from'react-icons/fa';const useStyles=makeStyles(theme=>({ListSubheader:{height:26,marginTop:\"-15px\",marginBottom:\"-10px\"},logoutButton:{borderRadius:10,marginTop:10,backgroundColor:theme.palette.sair.main,color:\"white\"}}));function ListItemLink(props){const{icon,primary,to,className}=props;const renderLink=React.useMemo(()=>React.forwardRef((itemProps,ref)=>/*#__PURE__*/React.createElement(RouterLink,Object.assign({to:to,ref:ref},itemProps))),[to]);return/*#__PURE__*/React.createElement(\"li\",null,/*#__PURE__*/React.createElement(ListItem,{button:true,dense:true,component:renderLink,className:className},icon?/*#__PURE__*/React.createElement(ListItemIcon,null,icon):null,/*#__PURE__*/React.createElement(ListItemText,{primary:primary})));}const reducer=(state,action)=>{if(action.type===\"LOAD_CHATS\"){const chats=action.payload;const newChats=[];if(isArray(chats)){chats.forEach(chat=>{const chatIndex=state.findIndex(u=>u.id===chat.id);if(chatIndex!==-1){state[chatIndex]=chat;}else{newChats.push(chat);}});}return[...state,...newChats];}if(action.type===\"UPDATE_CHATS\"){const chat=action.payload;const chatIndex=state.findIndex(u=>u.id===chat.id);if(chatIndex!==-1){state[chatIndex]=chat;return[...state];}else{return[chat,...state];}}if(action.type===\"DELETE_CHAT\"){const chatId=action.payload;const chatIndex=state.findIndex(u=>u.id===chatId);if(chatIndex!==-1){state.splice(chatIndex,1);}return[...state];}if(action.type===\"RESET\"){return[];}if(action.type===\"CHANGE_CHAT\"){const changedChats=state.map(chat=>{if(chat.id===action.payload.chat.id){return action.payload.chat;}return chat;});return changedChats;}};const MainListItems=props=>{const classes=useStyles();const{drawerClose,collapsed}=props;const{whatsApps}=useContext(WhatsAppsContext);const{user,handleLogout}=useContext(AuthContext);const[connectionWarning,setConnectionWarning]=useState(false);const[showCampaigns,setShowCampaigns]=useState(false);const[showKanban,setShowKanban]=useState(false);const[showOpenAi,setShowOpenAi]=useState(false);const[showIntegrations,setShowIntegrations]=useState(false);const[showSchedules,setShowSchedules]=useState(false);const[showInternalChat,setShowInternalChat]=useState(false);const[showExternalApi,setShowExternalApi]=useState(false);const isMounted=useRef(true);const[invisible,setInvisible]=useState(true);const[pageNumber,setPageNumber]=useState(1);const[searchParam]=useState(\"\");const[chats,dispatch]=useReducer(reducer,[]);const{getPlanCompany}=usePlans();const socketManager=useContext(SocketContext);useEffect(()=>{dispatch({type:\"RESET\"});setPageNumber(1);},[searchParam]);useEffect(()=>{return()=>{isMounted.current=false;};},[]);useEffect(()=>{async function fetchData(){if(isMounted.current){const companyId=user.companyId;if(companyId){const planConfigs=await getPlanCompany(undefined,companyId);if(isMounted.current){setShowCampaigns(planConfigs.plan.useCampaigns);setShowKanban(planConfigs.plan.useKanban);setShowOpenAi(planConfigs.plan.useOpenAi);setShowIntegrations(planConfigs.plan.useIntegrations);setShowSchedules(planConfigs.plan.useSchedules);setShowInternalChat(planConfigs.plan.useInternalChat);setShowExternalApi(planConfigs.plan.useExternalApi);}}}}fetchData();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);useEffect(()=>{if(isMounted.current){const delayDebounceFn=setTimeout(()=>{if(isMounted.current){fetchChats();}},500);return()=>clearTimeout(delayDebounceFn);}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[searchParam,pageNumber]);useEffect(()=>{if(isMounted.current){const companyId=localStorage.getItem(\"companyId\");const socket=socketManager.getSocket(companyId);const handleChatEvent=data=>{if(isMounted.current){if(data.action===\"new-message\"){dispatch({type:\"CHANGE_CHAT\",payload:data});}if(data.action===\"update\"){dispatch({type:\"CHANGE_CHAT\",payload:data});}}};socket.on(`company-${companyId}-chat`,handleChatEvent);return()=>{if(socket&&isMounted.current){socket.off(`company-${companyId}-chat`,handleChatEvent);}};}},[socketManager]);useEffect(()=>{if(isMounted.current){let unreadsCount=0;if(chats.length>0){for(let chat of chats){for(let chatUser of chat.users){if(chatUser.userId===user.id){unreadsCount+=chatUser.unreads;}}}}if(unreadsCount>0){setInvisible(false);}else{setInvisible(true);}}},[chats,user.id]);useEffect(()=>{if(isMounted.current){if(localStorage.getItem(\"cshow\")){setShowCampaigns(true);}}},[]);useEffect(()=>{if(isMounted.current){const delayDebounceFn=setTimeout(()=>{if(isMounted.current&&whatsApps.length>0){const offlineWhats=whatsApps.filter(whats=>{return whats.status===\"qrcode\"||whats.status===\"PAIRING\"||whats.status===\"DISCONNECTED\"||whats.status===\"TIMEOUT\"||whats.status===\"OPENING\";});if(offlineWhats.length>0){setConnectionWarning(true);}else{setConnectionWarning(false);}}},2000);return()=>clearTimeout(delayDebounceFn);}},[whatsApps]);const fetchChats=async()=>{try{const{data}=await api.get(\"/chats/\",{params:{searchParam,pageNumber}});if(isMounted.current){dispatch({type:\"LOAD_CHATS\",payload:data.records});}}catch(err){if(isMounted.current){toastError(err);}}};const handleClickLogout=()=>{//handleCloseMenu();\nhandleLogout();};return/*#__PURE__*/React.createElement(\"div\",{onClick:drawerClose},/*#__PURE__*/React.createElement(Can,{role:user.profile,perform:\"drawer-service-items:view\",style:{overflowY:\"scroll\"},no:()=>/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(ListSubheader,{hidden:collapsed,style:{position:\"relative\",fontSize:\"17px\",textAlign:\"left\",paddingLeft:20},inset:true,color:\"inherit\"},/*#__PURE__*/React.createElement(Typography,{variant:\"overline\",style:{fontWeight:'normal'}},\"  \",i18n.t(\"hardcodedElements.atendimento\"),\" \")),/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(ListItemLink,{to:\"/tickets\",primary:i18n.t(\"mainDrawer.listItems.tickets\"),icon:/*#__PURE__*/React.createElement(WhatsAppIcon,null)}),/*#__PURE__*/React.createElement(ListItemLink,{to:\"/quick-messages\",primary:i18n.t(\"mainDrawer.listItems.quickMessages\"),icon:/*#__PURE__*/React.createElement(FlashOnIcon,null)}),showKanban&&/*#__PURE__*/React.createElement(ListItemLink,{to:\"/kanban\",primary:\"Kanban\",icon:/*#__PURE__*/React.createElement(LoyaltyRoundedIcon,null)}),/*#__PURE__*/React.createElement(ListItemLink,{to:\"/todolist\",primary:i18n.t(\"hardcodedElements.tarefas\"),icon:/*#__PURE__*/React.createElement(BorderColorIcon,null)}),/*#__PURE__*/React.createElement(ListItemLink,{to:\"/contacts\",primary:i18n.t(\"mainDrawer.listItems.contacts\"),icon:/*#__PURE__*/React.createElement(ContactPhoneOutlinedIcon,null)}),showSchedules&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(ListItemLink,{to:\"/schedules\",primary:i18n.t(\"mainDrawer.listItems.schedules\"),icon:/*#__PURE__*/React.createElement(Schedule,null)})),/*#__PURE__*/React.createElement(ListItemLink,{to:\"/tags\",primary:i18n.t(\"mainDrawer.listItems.tags\"),icon:/*#__PURE__*/React.createElement(LocalOfferIcon,null)}),showInternalChat&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(ListItemLink,{to:\"/chats\",primary:i18n.t(\"mainDrawer.listItems.chats\"),icon:/*#__PURE__*/React.createElement(Badge,{color:\"secondary\",variant:\"dot\",invisible:invisible},/*#__PURE__*/React.createElement(ForumIcon,null))})),/*#__PURE__*/React.createElement(ListItemLink,{to:\"/helps\",primary:i18n.t(\"mainDrawer.listItems.helps\"),icon:/*#__PURE__*/React.createElement(HelpOutlineIcon,null)})))}),/*#__PURE__*/React.createElement(Can,{role:user.profile,perform:\"drawer-admin-items:view\",yes:()=>/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(ListSubheader,{hidden:collapsed,style:{position:\"relative\",fontSize:\"17px\",textAlign:\"left\",paddingLeft:20},inset:true,color:\"inherit\"},/*#__PURE__*/React.createElement(Typography,{variant:\"overline\",style:{fontWeight:'normal'}},\"  \",i18n.t(\"hardcodedElements.gerencia\"),\" \")),/*#__PURE__*/React.createElement(ListItemLink,{small:true,to:\"/\",primary:\"Dashboard\",icon:/*#__PURE__*/React.createElement(DashboardOutlinedIcon,null)}))}),/*#__PURE__*/React.createElement(Can,{role:user.profile,perform:\"drawer-admin-items:view\",yes:()=>/*#__PURE__*/React.createElement(React.Fragment,null,showCampaigns&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(ListSubheader,{hidden:collapsed,style:{position:\"relative\",fontSize:\"17px\",textAlign:\"left\",paddingLeft:20},inset:true,color:\"inherit\"},/*#__PURE__*/React.createElement(Typography,{variant:\"overline\",style:{fontWeight:'normal'}},\"  \",i18n.t(\"hardcodedElements.campanhas\"),\" \")),/*#__PURE__*/React.createElement(ListItemLink,{small:true,to:\"/campaigns\",primary:i18n.t(\"hardcodedElements.listagem\"),icon:/*#__PURE__*/React.createElement(ListIcon,null)}),/*#__PURE__*/React.createElement(ListItemLink,{small:true,to:\"/contact-lists\",primary:i18n.t(\"Listas de Contatos\"),icon:/*#__PURE__*/React.createElement(PeopleIcon,null)}),/*#__PURE__*/React.createElement(ListItemLink,{small:true,to:\"/campaigns-config\",primary:i18n.t(\"hardcodedElements.configuracoes\"),icon:/*#__PURE__*/React.createElement(ListIcon,null)})),/*#__PURE__*/React.createElement(ListSubheader,{hidden:collapsed,style:{position:\"relative\",fontSize:\"17px\",textAlign:\"left\",paddingLeft:20},inset:true,color:\"inherit\"},/*#__PURE__*/React.createElement(Typography,{variant:\"overline\",style:{fontWeight:'normal'}},\"  \",i18n.t(\"hardcodedElements.administracao\"),\" \")),user.super&&/*#__PURE__*/React.createElement(ListItemLink,{to:\"/announcements\",primary:i18n.t(\"mainDrawer.listItems.annoucements\"),icon:/*#__PURE__*/React.createElement(AnnouncementIcon,null)}),/*#__PURE__*/React.createElement(ListItemLink,{to:\"/hub-notificame\",primary:\"Meta\",icon:/*#__PURE__*/React.createElement(FaBell,{color:\"#607d8b\",size:24})}),showOpenAi&&/*#__PURE__*/React.createElement(ListItemLink,{to:\"/prompts\",primary:i18n.t(\"mainDrawer.listItems.prompts\"),icon:/*#__PURE__*/React.createElement(AllInclusive,null)}),showIntegrations&&/*#__PURE__*/React.createElement(ListItemLink,{to:\"/queue-integration\",primary:i18n.t(\"mainDrawer.listItems.queueIntegration\"),icon:/*#__PURE__*/React.createElement(DeviceHubOutlined,null)}),/*#__PURE__*/React.createElement(ListItemLink,{to:\"/connections\",primary:i18n.t(\"mainDrawer.listItems.connections\"),icon:/*#__PURE__*/React.createElement(Badge,{badgeContent:connectionWarning?\"!\":0,color:\"error\"},/*#__PURE__*/React.createElement(SyncAltIcon,null))}),/*#__PURE__*/React.createElement(ListItemLink,{to:\"/files\",primary:i18n.t(\"mainDrawer.listItems.files\"),icon:/*#__PURE__*/React.createElement(AttachFile,null)}),/*#__PURE__*/React.createElement(ListItemLink,{to:\"/queues\",primary:i18n.t(\"mainDrawer.listItems.queues\"),icon:/*#__PURE__*/React.createElement(AccountTreeOutlinedIcon,null)}),/*#__PURE__*/React.createElement(ListItemLink,{to:\"/users\",primary:i18n.t(\"mainDrawer.listItems.users\"),icon:/*#__PURE__*/React.createElement(PeopleAltOutlinedIcon,null)}),showExternalApi&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(ListItemLink,{to:\"/messages-api\",primary:i18n.t(\"mainDrawer.listItems.messagesAPI\"),icon:/*#__PURE__*/React.createElement(CodeRoundedIcon,null)})),/*#__PURE__*/React.createElement(ListItemLink,{to:\"/financeiro\",primary:i18n.t(\"mainDrawer.listItems.financeiro\"),icon:/*#__PURE__*/React.createElement(LocalAtmIcon,null)}),/*#__PURE__*/React.createElement(ListItemLink,{to:\"/settings\",primary:i18n.t(\"mainDrawer.listItems.settings\"),icon:/*#__PURE__*/React.createElement(SettingsOutlinedIcon,null)}),!collapsed&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Divider,null),/*#__PURE__*/React.createElement(Typography,{style:{fontSize:\"12px\",padding:\"10px\",textAlign:\"right\",fontWeight:\"bold\"}},\"Watoolx\",\" \",/*#__PURE__*/React.createElement(\"span\",{style:{backgroundColor:'#FFD700',color:'#000',padding:'2px 6px',borderRadius:'3px',fontSize:'10px',fontWeight:'bold',display:'inline-block',minWidth:'50px',textAlign:'center',marginLeft:'4px'}},\"BASIC\"))))}),/*#__PURE__*/React.createElement(Divider,null),/*#__PURE__*/React.createElement(\"li\",null,/*#__PURE__*/React.createElement(ListItem,{button:true,dense:true,onClick:handleClickLogout,className:classes.logoutButton},/*#__PURE__*/React.createElement(ListItemIcon,null,/*#__PURE__*/React.createElement(RotateRight,null)),/*#__PURE__*/React.createElement(ListItemText,{primary:i18n.t(\"hardcodedElements.sair\")}))));};export default MainListItems;","map":null,"metadata":{},"sourceType":"module"}