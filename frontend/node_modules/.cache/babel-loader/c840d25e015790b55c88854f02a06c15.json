{"ast":null,"code":"import React,{useState,useEffect}from\"react\";import MainContainer from\"../../components/MainContainer\";import MainHeader from\"../../components/MainHeader\";import Title from\"../../components/Title\";import{makeStyles,Paper,Tabs,Tab}from\"@material-ui/core\";import TabPanel from\"../../components/TabPanel\";import SchedulesForm from\"../../components/SchedulesForm\";import CompaniesManager from\"../../components/CompaniesManager\";import PlansManager from\"../../components/PlansManager\";import HelpsManager from\"../../components/HelpsManager\";import Options from\"../../components/Settings/Options\";import Uploader from\"../../components/Settings/Uploader\";import NewCompaniesManager from\"../../pages/Companies\";import{i18n}from\"../../translate/i18n.js\";import{toast}from\"react-toastify\";import useCompanies from\"../../hooks/useCompanies\";import useAuth from\"../../hooks/useAuth.js\";import useSettings from\"../../hooks/useSettings\";import OnlyForSuperUser from\"../../components/OnlyForSuperUser\";const useStyles=makeStyles(theme=>({root:{flex:1,backgroundColor:theme.palette.background.paper},mainPaper:{...theme.scrollbarStyles,overflowY:\"scroll\",flex:1},tab:{backgroundColor:theme.palette.options,borderRadius:4},paper:{...theme.scrollbarStyles,overflowY:\"scroll\",padding:theme.spacing(2),display:\"flex\",alignItems:\"center\",width:\"100%\"},container:{width:\"100%\",maxHeight:\"100%\"},control:{padding:theme.spacing(1)},textfield:{width:\"100%\"}}));const SettingsCustom=()=>{const classes=useStyles();const[tab,setTab]=useState(\"options\");const[schedules,setSchedules]=useState([]);const[company,setCompany]=useState({});const[loading,setLoading]=useState(false);const[currentUser,setCurrentUser]=useState({});const[settings,setSettings]=useState({});const[schedulesEnabled,setSchedulesEnabled]=useState(false);const{getCurrentUserInfo}=useAuth();const{find,updateSchedules}=useCompanies();const{getAll:getAllSettings}=useSettings();useEffect(()=>{async function findData(){setLoading(true);try{const companyId=localStorage.getItem(\"companyId\");const company=await find(companyId);const settingList=await getAllSettings();setCompany(company);setSchedules(company.schedules);setSettings(settingList);if(Array.isArray(settingList)){const scheduleType=settingList.find(d=>d.key===\"scheduleType\");if(scheduleType){setSchedulesEnabled(scheduleType.value===\"company\");}}const user=await getCurrentUserInfo();setCurrentUser(user);}catch(e){toast.error(e);}setLoading(false);}findData();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);const handleTabChange=(event,newValue)=>{async function findData(){setLoading(true);try{const companyId=localStorage.getItem(\"companyId\");const company=await find(companyId);const settingList=await getAllSettings();setCompany(company);setSchedules(company.schedules);setSettings(settingList);if(Array.isArray(settingList)){const scheduleType=settingList.find(d=>d.key===\"scheduleType\");if(scheduleType){setSchedulesEnabled(scheduleType.value===\"company\");}}const user=await getCurrentUserInfo();setCurrentUser(user);}catch(e){toast.error(e);}setLoading(false);}findData();// eslint-disable-next-line react-hooks/exhaustive-deps\nsetTab(newValue);};const handleSubmitSchedules=async data=>{setLoading(true);try{setSchedules(data);await updateSchedules({id:company.id,schedules:data});toast.success(i18n.t(\"settings.schedules.success\"));}catch(e){toast.error(e);}setLoading(false);};const isSuper=()=>{return currentUser.super;};return/*#__PURE__*/React.createElement(MainContainer,{className:classes.root},/*#__PURE__*/React.createElement(MainHeader,null,/*#__PURE__*/React.createElement(Title,null,i18n.t(\"settings.title\"))),/*#__PURE__*/React.createElement(Paper,{className:classes.mainPaper,elevation:1},/*#__PURE__*/React.createElement(Tabs,{value:tab,indicatorColor:\"primary\",textColor:\"primary\",scrollButtons:\"on\",variant:\"scrollable\",onChange:handleTabChange,className:classes.tab},/*#__PURE__*/React.createElement(Tab,{label:i18n.t(\"settings.tabs.options\"),value:\"options\"}),schedulesEnabled&&/*#__PURE__*/React.createElement(Tab,{label:i18n.t(\"settings.tabs.schedules\"),value:\"schedules\"}),isSuper()?/*#__PURE__*/React.createElement(Tab,{label:i18n.t(\"settings.tabs.logo\"),value:\"uploader\"}):null,isSuper()?/*#__PURE__*/React.createElement(Tab,{label:i18n.t(\"settings.tabs.companies\"),value:\"companies\"}):null,isSuper()?/*#__PURE__*/React.createElement(Tab,{label:i18n.t(\"settings.tabs.registerCompany\"),value:\"newcompanie\"}):null,isSuper()?/*#__PURE__*/React.createElement(Tab,{label:i18n.t(\"settings.tabs.plans\"),value:\"plans\"}):null,isSuper()?/*#__PURE__*/React.createElement(Tab,{label:i18n.t(\"settings.tabs.help\"),value:\"helps\"}):null),/*#__PURE__*/React.createElement(Paper,{className:classes.paper,elevation:0},/*#__PURE__*/React.createElement(TabPanel,{className:classes.container,value:tab,name:\"schedules\"},/*#__PURE__*/React.createElement(SchedulesForm,{loading:loading,onSubmit:handleSubmitSchedules,initialValues:schedules})),/*#__PURE__*/React.createElement(OnlyForSuperUser,{user:currentUser,yes:()=>/*#__PURE__*/React.createElement(TabPanel,{className:classes.container,value:tab,name:\"companies\"},/*#__PURE__*/React.createElement(CompaniesManager,null))}),/*#__PURE__*/React.createElement(OnlyForSuperUser,{user:currentUser,yes:()=>/*#__PURE__*/React.createElement(TabPanel,{className:classes.container,value:tab,name:\"newcompanie\"},/*#__PURE__*/React.createElement(NewCompaniesManager,null))}),/*#__PURE__*/React.createElement(OnlyForSuperUser,{user:currentUser,yes:()=>/*#__PURE__*/React.createElement(TabPanel,{className:classes.container,value:tab,name:\"plans\"},/*#__PURE__*/React.createElement(PlansManager,null))}),/*#__PURE__*/React.createElement(OnlyForSuperUser,{user:currentUser,yes:()=>/*#__PURE__*/React.createElement(TabPanel,{className:classes.container,value:tab,name:\"helps\"},/*#__PURE__*/React.createElement(HelpsManager,null))}),/*#__PURE__*/React.createElement(OnlyForSuperUser,{user:currentUser,yes:()=>/*#__PURE__*/React.createElement(TabPanel,{className:classes.container,value:tab,name:\"uploader\"},/*#__PURE__*/React.createElement(Uploader,null))}),/*#__PURE__*/React.createElement(TabPanel,{className:classes.container,value:tab,name:\"options\"},/*#__PURE__*/React.createElement(Options,{settings:settings,scheduleTypeChanged:value=>setSchedulesEnabled(value===\"company\")})))));};export default SettingsCustom;","map":null,"metadata":{},"sourceType":"module"}