{"ast":null,"code":"import React,{useContext,useState,useEffect}from\"react\";import Paper from\"@material-ui/core/Paper\";import Container from\"@material-ui/core/Container\";import Grid from\"@material-ui/core/Grid\";import MenuItem from\"@material-ui/core/MenuItem\";import FormControl from\"@material-ui/core/FormControl\";import InputLabel from\"@material-ui/core/InputLabel\";import Select from\"@material-ui/core/Select\";import TextField from\"@material-ui/core/TextField\";import FormHelperText from\"@material-ui/core/FormHelperText\";import Typography from\"@material-ui/core/Typography\";import MobileFriendlyIcon from'@material-ui/icons/MobileFriendly';import StoreIcon from'@material-ui/icons/Store';import CallIcon from\"@material-ui/icons/Call\";import GroupAddIcon from\"@material-ui/icons/GroupAdd\";import HourglassEmptyIcon from\"@material-ui/icons/HourglassEmpty\";import CheckCircleIcon from\"@material-ui/icons/CheckCircle\";import AccessAlarmIcon from'@material-ui/icons/AccessAlarm';import TimerIcon from'@material-ui/icons/Timer';import{makeStyles}from\"@material-ui/core/styles\";import{grey,blue}from\"@material-ui/core/colors\";import{toast}from\"react-toastify\";import ButtonWithSpinner from\"../../components/ButtonWithSpinner\";import TableAttendantsStatus from\"../../components/Dashboard/TableAttendantsStatus\";import{isArray}from\"lodash\";import{AuthContext}from\"../../context/Auth/AuthContext\";import useDashboard from\"../../hooks/useDashboard\";import useContacts from\"../../hooks/useContacts\";import{ChatsUser}from\"./ChartsUser\";import{isEmpty}from\"lodash\";import moment from\"moment\";import{ChartsDate}from\"./ChartsDate\";import{i18n}from\"../../translate/i18n\";const useStyles=makeStyles(theme=>({container:{paddingTop:theme.spacing(4),paddingBottom:theme.spacing(4),paddingLeft:theme.spacing(1),paddingRight:theme.spacing(2)},fixedHeightPaper:{padding:theme.spacing(2),display:\"flex\",flexDirection:\"column\",height:240,overflowY:\"auto\",...theme.scrollbarStyles},cardAvatar:{fontSize:\"55px\",color:grey[500],backgroundColor:\"#ffffff\",width:theme.spacing(7),height:theme.spacing(7)},cardTitle:{fontSize:\"18px\",color:blue[700]},cardSubtitle:{color:grey[600],fontSize:\"14px\"},alignRight:{textAlign:\"right\"},fullWidth:{width:\"100%\"},selectContainer:{width:\"100%\",textAlign:\"left\"},iframeDashboard:{width:\"100%\",height:\"calc(100vh - 64px)\",border:\"none\"},customFixedHeightPaper:{padding:theme.spacing(2),display:\"flex\",overflow:\"auto\",flexDirection:\"column\",height:120},customFixedHeightPaperLg:{padding:theme.spacing(2),display:\"flex\",overflow:\"auto\",flexDirection:\"column\",height:\"100%\"},card0:{padding:theme.spacing(2),display:\"flex\",overflow:\"auto\",flexDirection:\"column\",height:\"100%\",backgroundColor:\"#1e3a8a\",color:\"#ffffff\"},card00:{padding:theme.spacing(2),display:\"flex\",overflow:\"auto\",flexDirection:\"column\",height:\"100%\",backgroundColor:\"#1e3a8a\",color:\"#ffffff\"},card1:{padding:theme.spacing(2),display:\"flex\",overflow:\"auto\",flexDirection:\"column\",height:\"100%\",backgroundColor:\"#1e3a8a\",color:\"#ffffff\"},card2:{padding:theme.spacing(2),display:\"flex\",overflow:\"auto\",flexDirection:\"column\",height:\"100%\",backgroundColor:\"#1e3a8a\",color:\"#ffffff\"},card3:{padding:theme.spacing(2),display:\"flex\",overflow:\"auto\",flexDirection:\"column\",height:\"100%\",backgroundColor:\"#1e3a8a\",color:\"#ffffff\"},card4:{padding:theme.spacing(2),display:\"flex\",overflow:\"auto\",flexDirection:\"column\",height:\"100%\",backgroundColor:\"#1e3a8a\",color:\"#ffffff\"},card5:{padding:theme.spacing(2),display:\"flex\",overflow:\"auto\",flexDirection:\"column\",height:\"100%\",backgroundColor:\"#1e3a8a\",color:\"#ffffff\"},card6:{padding:theme.spacing(2),display:\"flex\",overflow:\"auto\",flexDirection:\"column\",height:\"100%\",backgroundColor:\"#1e3a8a\",color:\"#ffffff\"},card7:{padding:theme.spacing(2),display:\"flex\",overflow:\"auto\",flexDirection:\"column\",height:\"100%\",backgroundColor:\"#1e3a8a\",color:\"#ffffff\"},card8:{padding:theme.spacing(2),display:\"flex\",overflow:\"auto\",flexDirection:\"column\",height:\"100%\",backgroundColor:\"#1e3a8a\",color:\"#ffffff\"},card9:{padding:theme.spacing(2),display:\"flex\",overflow:\"auto\",flexDirection:\"column\",height:\"100%\",backgroundColor:\"#1e3a8a\",color:\"#ffffff\"},fixedHeightPaper2:{padding:theme.spacing(2),display:\"flex\",overflow:\"auto\",flexDirection:\"column\"}}));const Dashboard=()=>{const classes=useStyles();const[counters,setCounters]=useState({});const[attendants,setAttendants]=useState([]);const[period,setPeriod]=useState(0);const[filterType,setFilterType]=useState(1);const[dateFrom,setDateFrom]=useState(moment(\"1\",\"D\").format(\"YYYY-MM-DD\"));const[dateTo,setDateTo]=useState(moment().format(\"YYYY-MM-DD\"));const[loading,setLoading]=useState(false);const{find}=useDashboard();const{user}=useContext(AuthContext);useEffect(()=>{// ✅ CARGAR DATOS AUTOMÁTICAMENTE AL ABRIR EL DASHBOARD\nasync function firstLoad(){// Establecer valores por defecto para mostrar datos útiles\nif(filterType===1){// Si es filtro por fecha, usar últimos 7 días por defecto\nconst defaultDateFrom=moment().subtract(7,'days').format(\"YYYY-MM-DD\");const defaultDateTo=moment().format(\"YYYY-MM-DD\");setDateFrom(defaultDateFrom);setDateTo(defaultDateTo);}else{// Si es filtro por período, usar últimos 7 días por defecto\nsetPeriod(7);}// Cargar datos automáticamente\nawait fetchData();}setTimeout(()=>{firstLoad();},1000);// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);async function handleChangePeriod(value){setPeriod(value);}async function handleChangeFilterType(value){setFilterType(value);if(value===1){setPeriod(0);}else{setDateFrom(\"\");setDateTo(\"\");}}async function fetchData(){setLoading(true);let params={};if(period>0){params={days:period};}if(!isEmpty(dateFrom)&&moment(dateFrom).isValid()){params={...params,date_from:moment(dateFrom).format(\"YYYY-MM-DD\")};}if(!isEmpty(dateTo)&&moment(dateTo).isValid()){params={...params,date_to:moment(dateTo).format(\"YYYY-MM-DD\")};}// ✅ MEJORAR MANEJO DE PARÁMETROS - Si no hay parámetros, usar últimos 7 días por defecto\nif(Object.keys(params).length===0){params={days:7// Usar últimos 7 días por defecto\n};}try{const data=await find(params);// ✅ MEJORAR MANEJO DE DATOS - Asegurar que counters tenga valores por defecto\nif(data&&data.counters){setCounters({avgSupportTime:data.counters.avgSupportTime||0,avgWaitTime:data.counters.avgWaitTime||0,supportHappening:data.counters.supportHappening||0,supportPending:data.counters.supportPending||0,supportFinished:data.counters.supportFinished||0,leads:data.counters.leads||0,totalCompanies:data.counters.totalCompanies||0,totalWhatsappSessions:data.counters.totalWhatsappSessions||0});}else{// ✅ VALORES POR DEFECTO SI NO HAY DATOS\nsetCounters({avgSupportTime:0,avgWaitTime:0,supportHappening:0,supportPending:0,supportFinished:0,leads:0,totalCompanies:0,totalWhatsappSessions:0});}if(isArray(data===null||data===void 0?void 0:data.attendants)){setAttendants(data.attendants);}else{setAttendants([]);}}catch(error){console.error(\"Error al cargar datos del dashboard:\",error);toast.error(i18n.t(\"dashboard.errors.loadData\"));// ✅ VALORES POR DEFECTO EN CASO DE ERROR\nsetCounters({avgSupportTime:0,avgWaitTime:0,supportHappening:0,supportPending:0,supportFinished:0,leads:0,totalCompanies:0,totalWhatsappSessions:0});setAttendants([]);}setLoading(false);}function formatTime(minutes){return moment().startOf(\"day\").add(minutes,\"minutes\").format(\"HH[h] mm[m]\");}const GetContacts=all=>{let props={};if(all){props={};}const{count}=useContacts(props);return count;};function renderFilters(){if(filterType===1){return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,sm:6,md:4},/*#__PURE__*/React.createElement(TextField,{label:i18n.t(\"dashboard.filters.initialDate\"),type:\"date\",value:dateFrom,onChange:e=>setDateFrom(e.target.value),className:classes.fullWidth,InputLabelProps:{shrink:true}})),/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,sm:6,md:4},/*#__PURE__*/React.createElement(TextField,{label:i18n.t(\"dashboard.filters.finalDate\"),type:\"date\",value:dateTo,onChange:e=>setDateTo(e.target.value),className:classes.fullWidth,InputLabelProps:{shrink:true}})));}else{return/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,sm:6,md:4},/*#__PURE__*/React.createElement(FormControl,{className:classes.selectContainer},/*#__PURE__*/React.createElement(InputLabel,{id:\"period-selector-label\"},i18n.t(\"dashboard.filters.period\")),/*#__PURE__*/React.createElement(Select,{labelId:\"period-selector-label\",id:\"period-selector\",value:period,onChange:e=>handleChangePeriod(e.target.value)},/*#__PURE__*/React.createElement(MenuItem,{value:0},i18n.t(\"dashboard.filters.noSelection\")),/*#__PURE__*/React.createElement(MenuItem,{value:3},i18n.t(\"dashboard.filters.last3Days\")),/*#__PURE__*/React.createElement(MenuItem,{value:7},i18n.t(\"dashboard.filters.last7Days\")),/*#__PURE__*/React.createElement(MenuItem,{value:15},i18n.t(\"dashboard.filters.last15Days\")),/*#__PURE__*/React.createElement(MenuItem,{value:30},i18n.t(\"dashboard.filters.last30Days\")),/*#__PURE__*/React.createElement(MenuItem,{value:60},i18n.t(\"dashboard.filters.last60Days\")),/*#__PURE__*/React.createElement(MenuItem,{value:90},i18n.t(\"dashboard.filters.last90Days\"))),/*#__PURE__*/React.createElement(FormHelperText,null,i18n.t(\"dashboard.filters.selectPeriod\"))));}}return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Container,{maxWidth:\"lg\",className:classes.container},/*#__PURE__*/React.createElement(Grid,{container:true,spacing:3,justifyContent:\"flex-end\"},/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,sm:6,md:4},/*#__PURE__*/React.createElement(FormControl,{className:classes.selectContainer},/*#__PURE__*/React.createElement(InputLabel,{id:\"period-selector-label\"},i18n.t(\"dashboard.filters.filterType\")),/*#__PURE__*/React.createElement(Select,{labelId:\"period-selector-label\",value:filterType,onChange:e=>handleChangeFilterType(e.target.value)},/*#__PURE__*/React.createElement(MenuItem,{value:1},i18n.t(\"dashboard.filters.dateFilter\")),/*#__PURE__*/React.createElement(MenuItem,{value:2},i18n.t(\"dashboard.filters.periodFilter\"))),/*#__PURE__*/React.createElement(FormHelperText,null,i18n.t(\"dashboard.filters.selectPeriod\")))),renderFilters(),/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,className:classes.alignRight},/*#__PURE__*/React.createElement(ButtonWithSpinner,{loading:loading,onClick:()=>fetchData(),variant:\"contained\",color:\"primary\"},i18n.t(\"dashboard.filters.filter\"))),user.super&&/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,sm:6,md:3},/*#__PURE__*/React.createElement(Paper,{className:classes.card0,style:{overflow:\"hidden\"},elevation:4},/*#__PURE__*/React.createElement(Grid,{container:true,spacing:3},/*#__PURE__*/React.createElement(Grid,{item:true,xs:8},/*#__PURE__*/React.createElement(Typography,{component:\"h3\",variant:\"h6\",paragraph:true},i18n.t(\"dashboard.cards.activeConnections\")),/*#__PURE__*/React.createElement(Grid,{item:true},/*#__PURE__*/React.createElement(Typography,{component:\"h1\",variant:\"h4\"},counters.totalWhatsappSessions))),/*#__PURE__*/React.createElement(Grid,{item:true,xs:2},/*#__PURE__*/React.createElement(MobileFriendlyIcon,{style:{fontSize:100,color:\"#fff\"}}))))),user.super&&/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,sm:6,md:3},/*#__PURE__*/React.createElement(Paper,{className:classes.card00,style:{overflow:\"hidden\"},elevation:4},/*#__PURE__*/React.createElement(Grid,{container:true,spacing:3},/*#__PURE__*/React.createElement(Grid,{item:true,xs:8},/*#__PURE__*/React.createElement(Typography,{component:\"h3\",variant:\"h6\",paragraph:true},i18n.t(\"dashboard.cards.companies\")),/*#__PURE__*/React.createElement(Grid,{item:true},/*#__PURE__*/React.createElement(Typography,{component:\"h1\",variant:\"h4\"},counters.totalCompanies))),/*#__PURE__*/React.createElement(Grid,{item:true,xs:2},/*#__PURE__*/React.createElement(StoreIcon,{style:{fontSize:100,color:\"#fff\"}}))))),/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,sm:6,md:3},/*#__PURE__*/React.createElement(Paper,{className:classes.card1,style:{overflow:\"hidden\"},elevation:4},/*#__PURE__*/React.createElement(Grid,{container:true,spacing:3},/*#__PURE__*/React.createElement(Grid,{item:true,xs:8},/*#__PURE__*/React.createElement(Typography,{component:\"h3\",variant:\"h6\",paragraph:true},i18n.t(\"dashboard.cards.inConversation\")),/*#__PURE__*/React.createElement(Grid,{item:true},/*#__PURE__*/React.createElement(Typography,{component:\"h1\",variant:\"h4\"},counters.supportHappening))),/*#__PURE__*/React.createElement(Grid,{item:true,xs:2},/*#__PURE__*/React.createElement(CallIcon,{style:{fontSize:100,color:\"#fff\"}}))))),/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,sm:6,md:3},/*#__PURE__*/React.createElement(Paper,{className:classes.card2,style:{overflow:\"hidden\"},elevation:6},/*#__PURE__*/React.createElement(Grid,{container:true,spacing:3},/*#__PURE__*/React.createElement(Grid,{item:true,xs:8},/*#__PURE__*/React.createElement(Typography,{component:\"h3\",variant:\"h6\",paragraph:true},i18n.t(\"dashboard.cards.waiting\")),/*#__PURE__*/React.createElement(Grid,{item:true},/*#__PURE__*/React.createElement(Typography,{component:\"h1\",variant:\"h4\"},counters.supportPending))),/*#__PURE__*/React.createElement(Grid,{item:true,xs:4},/*#__PURE__*/React.createElement(HourglassEmptyIcon,{style:{fontSize:100,color:\"#fff\"}}))))),/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,sm:6,md:3},/*#__PURE__*/React.createElement(Paper,{className:classes.card3,style:{overflow:\"hidden\"},elevation:6},/*#__PURE__*/React.createElement(Grid,{container:true,spacing:3},/*#__PURE__*/React.createElement(Grid,{item:true,xs:8},/*#__PURE__*/React.createElement(Typography,{component:\"h3\",variant:\"h6\",paragraph:true},i18n.t(\"dashboard.cards.finished\")),/*#__PURE__*/React.createElement(Grid,{item:true},/*#__PURE__*/React.createElement(Typography,{component:\"h1\",variant:\"h4\"},counters.supportFinished))),/*#__PURE__*/React.createElement(Grid,{item:true,xs:4},/*#__PURE__*/React.createElement(CheckCircleIcon,{style:{fontSize:100,color:\"#fff\"}}))))),/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,sm:6,md:3},/*#__PURE__*/React.createElement(Paper,{className:classes.card4,style:{overflow:\"hidden\"},elevation:6},/*#__PURE__*/React.createElement(Grid,{container:true,spacing:3},/*#__PURE__*/React.createElement(Grid,{item:true,xs:8},/*#__PURE__*/React.createElement(Typography,{component:\"h3\",variant:\"h6\",paragraph:true},i18n.t(\"dashboard.cards.newContacts\")),/*#__PURE__*/React.createElement(Grid,{item:true},/*#__PURE__*/React.createElement(Typography,{component:\"h1\",variant:\"h4\"},GetContacts(true)))),/*#__PURE__*/React.createElement(Grid,{item:true,xs:4},/*#__PURE__*/React.createElement(GroupAddIcon,{style:{fontSize:100,color:\"#fff\"}}))))),/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,sm:6,md:3},/*#__PURE__*/React.createElement(Paper,{className:classes.card8,style:{overflow:\"hidden\"},elevation:6},/*#__PURE__*/React.createElement(Grid,{container:true,spacing:3},/*#__PURE__*/React.createElement(Grid,{item:true,xs:8},/*#__PURE__*/React.createElement(Typography,{component:\"h3\",variant:\"h6\",paragraph:true},i18n.t(\"dashboard.cards.avgConversationTime\")),/*#__PURE__*/React.createElement(Grid,{item:true},/*#__PURE__*/React.createElement(Typography,{component:\"h1\",variant:\"h4\"},formatTime(counters.avgSupportTime)))),/*#__PURE__*/React.createElement(Grid,{item:true,xs:4},/*#__PURE__*/React.createElement(AccessAlarmIcon,{style:{fontSize:100,color:\"#fff\"}}))))),/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,sm:6,md:3},/*#__PURE__*/React.createElement(Paper,{className:classes.card9,style:{overflow:\"hidden\"},elevation:6},/*#__PURE__*/React.createElement(Grid,{container:true,spacing:3},/*#__PURE__*/React.createElement(Grid,{item:true,xs:8},/*#__PURE__*/React.createElement(Typography,{component:\"h3\",variant:\"h6\",paragraph:true},i18n.t(\"dashboard.cards.avgWaitTime\")),/*#__PURE__*/React.createElement(Grid,{item:true},/*#__PURE__*/React.createElement(Typography,{component:\"h1\",variant:\"h4\"},formatTime(counters.avgWaitTime)))),/*#__PURE__*/React.createElement(Grid,{item:true,xs:4},/*#__PURE__*/React.createElement(TimerIcon,{style:{fontSize:100,color:\"#fff\"}}))))),/*#__PURE__*/React.createElement(Grid,{item:true,xs:12},attendants.length?/*#__PURE__*/React.createElement(TableAttendantsStatus,{attendants:attendants,loading:loading}):null),/*#__PURE__*/React.createElement(Grid,{item:true,xs:12},/*#__PURE__*/React.createElement(Paper,{className:classes.fixedHeightPaper2},/*#__PURE__*/React.createElement(ChatsUser,null))),/*#__PURE__*/React.createElement(Grid,{item:true,xs:12},/*#__PURE__*/React.createElement(Paper,{className:classes.fixedHeightPaper2},/*#__PURE__*/React.createElement(ChartsDate,null))))));};export default Dashboard;","map":null,"metadata":{},"sourceType":"module"}